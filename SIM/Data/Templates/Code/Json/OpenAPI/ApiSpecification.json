<%==SIM:ExplicitWhitespacesOn==%>
<%==SIM:AutoIndentOn==%>

<%==SIM:UserInput:IndentationSize=Number("Indentation size",4)==%>
<%==SIM:UserInput:IndentationChar=Choice("Indentation char",Space,Tab)==%>
<%==SIM:If:Eq(IndentationChar,"Tab")==%><%==SIM:SetTabIndent==%><%==SIM:Else==%><%==SIM:SetSpaceIndent==%><%==SIM:EndIf==%><%==SIM:IndentSize(IndentationSize)==%>

<%==SIM:Set:private=private==%><%==SIM:Set:protected=protected==%><%==SIM:Set:package= ==%><%==SIM:Set:public=public==%>

{
	<%==SIM:StartBlock==%><%==SIM:Line==%>
"openapi": "3.0.0",<%==SIM:Line==%>
"info": {<%==SIM:StartBlock==%><%==SIM:Line==%>
	"title": "<%==SIM:ToSingleLine(Diagram.Name)==%>",<%==SIM:Line==%>
	"description": "<%==SIM:Replace(Diagram.Documentation,"\"","\\\"")==%>",<%==SIM:Line==%>
	"termsOfService": "<%==SIM:Diagram.GetTaggedValue("TermsOfService")==%>",<%==SIM:Line==%>
	"version": "<%==SIM:Diagram.Version==%>"
	
	<%==SIM:Set:Contact=Diagram.ElementWithStereotype("contact")==%>
	<%==SIM:IfNot:IsEmpty(Contact)==%>
	,<%==SIM:Line==%>
	"contact": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
		"name": "<%==SIM:Contact.Name==%>",<%==SIM:Line==%>	
		"url": "<%==SIM:Coalesce(Contact.GetAttributeValue("Url"),Contact.Hyperlink)==%>",<%==SIM:Line==%>	
		"email": "<%==SIM:Contact.GetAttributeValue("Email")==%>"
		<%==SIM:EndBlock==%><%==SIM:Line==%>
	  }<%==SIM:Line==%>
	<%==SIM:EndIf==%>
	
	<%==SIM:Set:Contact=Diagram.ElementWithStereotype("contact")==%>
	<%==SIM:IfNot:IsEmpty(Contact)==%>
	,<%==SIM:Line==%>
	"license": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
		"name": "<%==SIM:Contact.Name==%>",<%==SIM:Line==%>	
		"url": "<%==SIM:Coalesce(Contact.GetAttributeValue("Url"),Contact.Hyperlink)==%>",<%==SIM:Line==%>	
		<%==SIM:EndBlock==%><%==SIM:Line==%>
	  }<%==SIM:Line==%>
	<%==SIM:EndIf==%>
	
<%==SIM:EndBlock==%><%==SIM:Line==%>
},<%==SIM:Line==%>


"servers": [<%==SIM:StartBlock==%><%==SIM:Line==%>	
<%==SIM:ForEach:Diagram.ElementsWithStereotype("server")==%>
{<%==SIM:StartBlock==%><%==SIM:Line==%>			
	"url": "<%==SIM:Element.Name==%>",<%==SIM:Line==%>	
	"description": "<%==SIM:Replace(Element.Documentation,"\"","\\\"")==%>",<%==SIM:Line==%>
	"variables": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
	<%==SIM:ForEach:Element.Attributes==%>
		"<%==SIM:Attribute.Name==%>": {<%==SIM:StartBlock==%><%==SIM:Line==%>
			"default": "<%==SIM:Attribute.DefaultValue==%>",<%==SIM:Line==%>
			"description": "<%==SIM:Replace(Attribute.Documentation,"\"","\\\"")==%>"
		<%==SIM:EndBlock==%><%==SIM:Line==%>}<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%>
	<%==SIM:EndFor==%>
	<%==SIM:EndBlock==%><%==SIM:Line==%>}<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>	
		
<%==SIM:EndBlock==%><%==SIM:Line==%>
}<%==SIM:Line==%>
<%==SIM:EndFor==%>
<%==SIM:EndBlock==%><%==SIM:Line==%>
],<%==SIM:Line==%>



"paths": {<%==SIM:StartBlock==%><%==SIM:Line==%>	

<%==SIM:ForEach:Diagram.ElementsWithStereotype("path")==%>
"<%==SIM:IfNot:StartsWith(Element.Name,"/")==%>/<%==SIM:EndIf==%><%==SIM:Element.Name==%>": {<%==SIM:StartBlock==%><%==SIM:Line==%>	

<%==SIM:ForEach:Element.NestedElements==%>
<%==SIM:IfNot:IsEmpty(NestedElement.Stereotypes.GetOneOf("get","post","put","delete","options","patch","options","head"))==%>
<%==SIM:IfNot:IsFirst==%>,<%==SIM:Line==%><%==SIM:EndIf==%><%==SIM:Set:IsFirst=True==%>
"<%==SIM:NestedElement.Stereotypes.GetOneOf("get","post","put","delete","options","patch","options","head")==%>": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
	<%==SIM:Set:HasPorts=True==%>

	"description": "<%==SIM:Replace(NestedElement.Documentation,"\"","\\\"")==%>",<%==SIM:Line==%>
	"responses": {<%==SIM:StartBlock==%><%==SIM:Line==%>	

<%==SIM:ForEach:NestedElement.Ports.FilterByStereotype("response")==%>
<%==SIM:ForEach:Port.Relations(Relation)==%>

"<%==SIM:Relation.Name==%>" : {<%==SIM:StartBlock==%><%==SIM:Line==%>
	"description": "<%==SIM:Replace(Relation.Documentation,"\"","\\\"")==%>"
	<%==SIM:IfNot:Relation.OtherElement(Port).HasStereotype("null")==%>
	<%==SIM:CLS==%>,<%==SIM:Line==%>"content": {<%==SIM:StartBlock==%><%==SIM:Line==%>
		"application/json": {<%==SIM:StartBlock==%><%==SIM:Line==%>
			  "schema": {<%==SIM:StartBlock==%><%==SIM:Line==%>                
				"$ref": "#/components/schemas/<%==SIM:Relation.OtherElement(Port).Name==%>"
			  <%==SIM:EndBlock==%><%==SIM:Line==%>}
			<%==SIM:EndBlock==%><%==SIM:Line==%>}
		<%==SIM:EndBlock==%><%==SIM:Line==%>}
	<%==SIM:EndIf==%>
	<%==SIM:EndBlock==%><%==SIM:Line==%>}<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>
<%==SIM:EndFor==%>
<%==SIM:EndFor==%>
	
<%==SIM:EndBlock==%><%==SIM:Line==%>
}

<%==SIM:Set:Port=NestedElement.Ports.FilterByStereotype("request").First==%>
<%==SIM:Set:Relation=Port.Relations.First==%>
<%==SIM:IfNot:IsEmpty(Relation)==%>
,<%==SIM:Line==%>
"requestBody": {<%==SIM:StartBlock==%><%==SIM:Line==%>	

	"description": "<%==SIM:Replace(Relation.Documentation,"\"","\\\"")==%>",<%==SIM:Line==%>
	"required": "true",<%==SIM:Line==%>
	"content": {<%==SIM:StartBlock==%><%==SIM:Line==%>
		"application/json": {<%==SIM:StartBlock==%><%==SIM:Line==%>
			  "schema": {<%==SIM:StartBlock==%><%==SIM:Line==%>                                
				"$ref": "#/components/schemas/<%==SIM:Relation.OtherElement(Port).Name==%>"
			  <%==SIM:EndBlock==%><%==SIM:Line==%>}
			<%==SIM:EndBlock==%><%==SIM:Line==%>}
	<%==SIM:EndBlock==%><%==SIM:Line==%>}
	
<%==SIM:EndBlock==%><%==SIM:Line==%>
}<%==SIM:Line==%>
<%==SIM:EndIf==%>

<%==SIM:EndBlock==%><%==SIM:Line==%>}
<%==SIM:EndIf==%>
<%==SIM:EndFor==%>


<%==SIM:If:HasPorts==%>,<%==SIM:Line==%><%==SIM:EndIf==%>"parameters" : [<%==SIM:StartBlock==%><%==SIM:Line==%>
<%==SIM:ForEach:Element.NestedElements.FilterByStereotype("parameter")==%>
<%==SIM:Include(Parameter.json, NestedElement, True)==%>
<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>
<%==SIM:EndFor==%>
<%==SIM:EndBlock==%><%==SIM:Line==%>]<%==SIM:Line==%>


<%==SIM:EndBlock==%><%==SIM:Line==%>
}<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>

<%==SIM:EndFor==%>

<%==SIM:EndBlock==%><%==SIM:Line==%>},<%==SIM:Line==%>



"components": {<%==SIM:StartBlock==%><%==SIM:Line==%>	

<%==SIM:ForEach:Diagram.Elements==%>
<%==SIM:If:And(Element.HasStereotype("component"),Not(Element.HasStereotype("parameter")))==%>
<%==SIM:Add(SchemaComponents,Element)==%>
<%==SIM:EndIf==%>
<%==SIM:EndFor==%>

"schemas": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
<%==SIM:ForEach:SchemaComponents(Element)==%>
"<%==SIM:Element.Name==%>" : {<%==SIM:StartBlock==%><%==SIM:Line==%>
	<%==SIM:Include(SchemaObject.json,Element,False)==%>
	
<%==SIM:EndBlock==%><%==SIM:Line==%>
}<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>
<%==SIM:EndFor==%>
<%==SIM:EndBlock==%><%==SIM:Line==%>},<%==SIM:Line==%>


"parameters": {<%==SIM:StartBlock==%><%==SIM:Line==%>	
<%==SIM:ForEach:Diagram.ElementsWithStereotypes(Element,"component","parameter")==%>
"<%==SIM:Element.Name==%>" : <%==SIM:Include(Parameter.json, Element, False)==%>
<%==SIM:IfNot:IsLastItem==%>,<%==SIM:EndIf==%><%==SIM:Line==%>
<%==SIM:EndFor==%>
<%==SIM:EndBlock==%><%==SIM:Line==%>}<%==SIM:Line==%>



<%==SIM:EndBlock==%><%==SIM:Line==%>}<%==SIM:Line==%>
<%==SIM:EndBlock==%><%==SIM:Line==%>}
